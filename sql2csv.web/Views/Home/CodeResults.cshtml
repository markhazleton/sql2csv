@model List<Sql2Csv.Web.Models.GeneratedCodeViewModel>
@{
    ViewData["Title"] = "Generated Code";
}

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Header -->
    <div class="mb-8">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-3xl font-bold text-secondary-900">Generated Code</h1>
                <p class="text-secondary-600 mt-2">
                    @Model.Count C# model classes generated
                </p>
            </div>
            <div class="flex space-x-3">
                <a asp-action="Analyze" class="btn-secondary">
                    <svg class="w-4 h-4 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                    </svg>
                    Back to Analysis
                </a>
                <button onclick="downloadAllCodeFiles()" class="btn-primary">
                    <svg class="w-4 h-4 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    Download All Classes
                </button>
            </div>
        </div>
    </div>

    <!-- Generated Classes -->
    <div class="space-y-6">
        @foreach (var codeResult in Model)
        {
            <div class="card">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center space-x-3">
                        <div class="bg-primary-100 rounded-lg p-2">
                            <svg class="w-5 h-5 text-primary-600" xmlns="http://www.w3.org/2000/svg" fill="none"
                                viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
                            </svg>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-secondary-900">@codeResult.ClassName</h3>
                            <p class="text-sm text-secondary-600">
                                Generated from <span class="font-medium">@codeResult.TableName</span> table
                            </p>
                        </div>
                    </div>

                    <div class="flex space-x-2">
                        <button
                            onclick="downloadCodeFile('@(codeResult.ClassName).cs', @Html.Raw(Json.Serialize(codeResult.Code)))"
                            class="btn-outline text-sm">
                            <svg class="w-4 h-4 mr-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            Download
                        </button>
                        <button onclick="copyToClipboard(@Html.Raw(Json.Serialize(codeResult.Code)))"
                            class="btn-outline text-sm">
                            <svg class="w-4 h-4 mr-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                            </svg>
                            Copy
                        </button>
                    </div>
                </div>

                <div class="space-y-4" x-data="{ showCode: true }">
                    <div class="flex items-center justify-between">
                        <h4 class="font-medium text-secondary-900">@codeResult.Language Code</h4>
                        <button @@click="showCode = !showCode" class="btn-outline text-sm">
                            <span x-text="showCode ? 'Hide Code' : 'Show Code'"></span>
                        </button>
                    </div>
                    <div x-show="showCode" x-transition>
                        <div class="relative">
                            <div class="code-block">
                                <pre class="language-csharp"><code>@codeResult.Code</code></pre>
                            </div>
                            <button onclick="copyToClipboard(@Html.Raw(Json.Serialize(codeResult.Code)))"
                                class="absolute top-2 right-2 bg-secondary-800 hover:bg-secondary-700 text-secondary-200 p-2 rounded-lg transition-colors">
                                <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                    stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
</div>

@section Scripts {
    <script>
        function downloadCodeFile(filename, content)
        {
            downloadFile(content, filename, 'text/plain');
        }

        function downloadAllCodeFiles()
        {
                @foreach (var codeResult in Model)
                {
                    <text>
                        downloadFile(@Html.Raw(Json.Serialize(codeResult.Code)), '@(codeResult.ClassName).cs', 'text/plain');
                    </text>
            }
            }
    </script>
}
